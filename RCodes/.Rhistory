View(base)
View(base)
View(df_tot1)
summary(base$rating)
rm(df_tot1)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("../Base/MasterData/BasePERU_Proceso1.RData")
save(BD, file=filename)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("../Base/MasterData/BasePERU_Proceso1.RData")
save(base, file=filename)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("../Base/MasterData/BasePERU_Proceso1.RData")
save(base, file=filename)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("./Base/MasterData/BasePERU_Proceso1.RData")
save(base, file=filename)
source('C:/Users/alexa/Dropbox/TraspasoOnline/Pass-through/Script/07 ID Creation.R', echo=TRUE)
rm(list = ls())
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(2) Base de Datos
#-----------------------------------------
load("./Base/MasterData/BasePERU_Proceso1.RData")
BASEDATOS <- BD
#(4) Eliminamos subcategorias : VER TODO...
#-----------------------------------------
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
install.packages("tm")
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(4) Eliminamos subcategorias : VER TODO...
#-----------------------------------------
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
# Correccion de categorias y subcategorias --------------------------------
#Este script se realiza la reduccion y uniformizacion de la clasificacion de los productos
#de la tienda SF, de tal manera que cuadren con la CLASIFICACION de la base de importaciones.
#(1)Limpiar memoria y cargar librerias
#----------------------------------------
rm(list = ls())
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(2) Base de Datos
#-----------------------------------------
load("./Base/MasterData/BasePERU_Proceso1.RData")
source("../CategoriasFun.R")
source("../SubcategoriasFun.R")
#(4) Eliminamos subcategorias : VER TODO...
#-----------------------------------------
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
View(base)
rack <- grep("rack", BASEDATOS$descripcion)
rack <- grep("rack", base$descripcion)
rack
base <- base %>% mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria))
View(base)
base2 <- base %>%
mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria))
View(base2)
base2 <- base %>%
mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono"),"audífono",subcategoria))
View(base2)
base2 <- base %>%
mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífono",subcategoria))
View(base2)
#Tecnologia (desaparece seccion)
#--------------------------------
tecnologia <- subset(base2, categoria =="tecnología")
View(base2)
View(tecnologia)
debugSource('C:/Users/alexa/Dropbox/TraspasoOnline/Pass-through/Script/(8)Categoria_Subcategoria.R', encoding = 'UTF-8', echo=TRUE)
View(base)
lista <- base %>% select(categoria, subcategoria) %>% unique()
View(lista)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique()
View(lista)
unique(lista$categoria)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique()
grupocat <- unique(base$categoria)
grupocat
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria %in% grupocat,subcategoria,categoria))
View(lista)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria=="tecnología",subcategoria,categoria))
View(lista)
grupocat <- unique(lista$categoria)
grupocat
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique()
View(lista)
grupocat <- unique(lista$categoria)
grupocat <- unique(base$categoria)
grupocat
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
View(lista)
grupocat <- unique(base$categoria)
base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>% View()
grupocat <- unique(base$categoria)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
unique(lista$categoria)
View(lista)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria),
categoria = ifelse(str_detect(subcategoria,"computadoras","computadores",subcategoria)))
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria),
categoria = ifelse(str_detect(subcategoria,"computadoras"),"computadores",subcategoria))
View(lista)
grupocat <- unique(base$categoria)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
View(lista)
lista2 <- lista %>% mutate(categoria = ifelse(str_detect(categoria =="tecnología","computadoras") & categoria =="tecnología",
"computadores",subcategoria))
View(lista2)
lista2 <- lista %>% mutate(categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"computadoras"),
"computadores",categoria))
View(lista2)
lista2$subcategoria[lista2$categoria=="tecnología"]
unique(lista2$subcategoria[lista2$categoria=="tecnología"])
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
lista2 <- lista %>%
mutate(categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"computadoras"),
"computadores",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"audífono"),
"audio",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"telefonía"),
"teléfonos",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"cámaras digitales"),
"fotografía",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"tv lcd|accesorios tv"),
"televisores",categoria))
View(lista2)
lista3 <- lista2 %>% select(-subcategoria)%>%group_by(ID,categoria)%>% summarize(repeticiones = n())
View(lista3)
lista3 <- lista2%>%group_by(ID,categoria,subcategoria)%>% summarize(repeticiones = n())
View(lista3)
lista3 <- lista2%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())
View(lista3)
diccionario <- lista3%>% group_by(categoria,subcategoria)%>% summarise(rep = n())
View(diccionario)
diccionario <- lista3%>% select(-categoria)%>% summarise(rep = n())
View(diccionario)
lista3%>% select(-categoria)
lista3 <- lista2%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
diccionario <- lista3%>% select(-categoria)%>% summarise(rep = n())
View(diccionario)
lista3%>% select(-categoria)
diccionario <- lista3%>% select(-categoria)%>%group_by(subcategoria)%>% summarise(rep = n())
View(diccionario)
# Correccion de categorias y subcategorias --------------------------------
#Este script se realiza la reduccion y uniformizacion de la clasificacion de los productos
#de la tienda SF, de tal manera que cuadren con la CLASIFICACION de la base de importaciones.
#(1)Limpiar memoria y cargar librerias
#----------------------------------------
rm(list = ls())
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
#
# source("../CategoriasFun.R")
# source("../SubcategoriasFun.R")
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
# Grupo de categorias
grupocat <- unique(base$categoria)
grupocat
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
View(base)
# Grupo de categorias
grupocat <- unique(base$categoria)
grupocat
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
View(base)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
View(base)
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
correcciones <- lista3%>% select(-categoria)%>%group_by(subcategoria)%>% summarise(rep = n()) %>%
filter(rep>1)
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
View(lista3)
base <- base %>% left_join(lista3 %>% select(-repeticiones), by = "subcategoria")
View(base)
base <- base %>% left_join(lista3 %>% select(-repeticiones), by = "subcategoria") %>%
mutate(categoria.x = categoria.y, categoria = categoria.x)%>% select(-categoria.y)
View(base)
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
#
# source("../CategoriasFun.R")
# source("../SubcategoriasFun.R")
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
# Correcciones por categoria ---> Se crea una lista de categoria y subcategoria correcta
# con la finalidad de unir por subcategoria y corregir la categoria
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
base <- base %>% left_join(lista3 %>% select(-repeticiones), by = "subcategoria") %>%
mutate(categoria = categoria.y)%>% select(-c(categoria.y,categoria.x))
View(base)
View(lista3)
View(lista3)
View(base)
lista4 <- base%>%group_by(ID,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
View(lista4)
lista4 <- base%>%group_by(ID,subcategoria)%>% mutate(repeticiones = n())%>%ungroup()
base_c <- base%>%group_by(ID,subcategoria)%>% mutate(repeticiones = n())%>%ungroup()
View(base_c)
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%View()
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeteciones ==max(repeteciones)%>%View())
base <- base %>% left_join(base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones)%>%View()))
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones)
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones))%>%View()
base_c <- base %>% left_join(base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones))%>%select(-repeticiones),
by = "ID")
rm(list = ls())
#(2) Base de Datos
#-----------------------------------------
load("./Base/MasterData/BasePERU_Proceso1.RData")
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = gsub("-"," ",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = gsub("-"," ",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(
str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
View(lista3)
View(base)
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"refrigeracion"),"refrigeración",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"cocina"),"cocinas",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"linea blanca"),"línea blanca",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"ventiladores y aire acondicionado|ventiladores"),"ventilación y aire acondicionado",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"smartphones"),"celulares y smartphones",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"televisores|tv|tv televisores"),"tv",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"teléfonos|telefonía"),"accesorios smartphone",subcategoria))
View(base)
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = gsub("-"," ",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"refrigeracion"),"refrigeración",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"cocina"),"cocinas",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"linea blanca"),"línea blanca",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"ventiladores y aire acondicionado|ventiladores"),"ventilación y aire acondicionado",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"smartphones"),"celulares y smartphones",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"televisores|tv televisores"),"tv",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"teléfonos|telefonía"),"accesorios smartphone",subcategoria))
# Grupo de categorias --> Tecnologia
grupocat <- unique(base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
View(base)
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(
str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
View(lista3)
View(lista3)
source('~/Traspaso_Online/RCodes/08 Category Subcategory correction.R', encoding = 'UTF-8', echo=TRUE)
# Completar dias ----------------------------------------------------------
# (1)Limpiar memoria y cargar librerias -----------------------------------
graphics.off()
rm(list=ls())
options(warn=0)
library(tidyverse)
library(dplyr)
library(data.table)
library(stringr)
options(warn=2)
# (2) Base de Datos -------------------------------------------------------
load("../output/DatosFiltrados/02_Base_filtrada_240.RData")
library(rio)
source('~/Traspaso_Online/RCodes/12 Exchange Rate.R', echo=TRUE)
nexchange_rate <-import(path = paste0(dirmother,"/USDPEN.xlsx"),1)
nexchange_rate <-import("./input/USDPEN.xlsx")
View(nexchange_rate)
#Formato Date
nexchange_rate$fecha <- as.Date(nexchange_rate$fecha)
sapply(nexchange_rate, class) #Revisamos los "types"
# Modificaciones al tipo de cambio ----------------------------------------
# (1)Limpiar memoria y cargar librerias -----------------------------------
graphics.off()
rm(list=ls())
library(dplyr)
library(rio)
library(stringr)
# (2) Base de Datos -------------------------------------------------------
nexchange_rate <-import("./input/USDPEN.xlsx")
sapply(nexchange_rate, class) #Revisamos los "types"
#Formato Date
nexchange_rate$fecha <- as.Date(nexchange_rate$fecha)
#Como no existe informacion del tipo de cambio en los dias feriados,sabados y
#domingos, se procede a crear una base con dias continuos y el proceso de
#llenado es con la funcion FILL.
all_days <- data.frame(fecha = seq.Date(from = min(nexchange_rate$fecha),
to = max(nexchange_rate$fecha),
by = "day"))
View(all_days)
exchange_completed <- left_join(all_days,
nexchange_rate,
by = "fecha",
check.names=FALSE)
View(exchange_completed)
exchange_completed <- exchange_completed %>% fill(USDPEN)
View(exchange_completed)
exchange_completed$dias <- weekdays(exchange_completed$fecha)
exchange_completed <- exchange_completed %>% filter(!dias %in% c("domingo","sábado"))
View(exchange_completed)
View(exchange_completed)
exchange_completed <- exchange_completed %>% filter(!dias %in% c("domingo","sábado")) %>%
select(-dias)
View(exchange_completed)
export(exchange_completed, "./input/USDPEN2.xlsx")
source('~/Traspaso_Online/RCodes/13 Estimates.R', echo=TRUE)
install.packages("dummies")
source('~/Traspaso_Online/RCodes/13 Estimates.R', echo=TRUE)
# (2)Funciones ------------------------------------------------------------
source("./funciones/regresion.R")
# (3) Base de Datos -------------------------------------------------------
load("../output/MasterData/Base_duraciones_01.RData")
# (3) Base de Datos -------------------------------------------------------
load("../output/MasterData/Base_duraciones_01.RData")
nexchange_rate <-import("./input/USDPEN2.xlsx")
# (4) Proceso -------------------------------------------------------------
#Se elimina aquellas duraciones de precios menores a 5 dias y los censurados.
tabla_duraciones <- filter(tabla_duraciones, DDias >=5 )
tabla_duraciones <- filter(tabla_duraciones, Status==0)
sapply(nexchange_rate, class) #Revisamos los "types"
sapply(tabla_duraciones, class)
#(5)Guardamos
#------------------
file_name <- "./output/MasterData/matrix_regresiones.RData"
save(alpha_matrix,std_matrix,tvalue_matrix, file = file_name)
source('~/Traspaso_Online/RCodes/13 Estimates.R', encoding = 'UTF-8', echo=TRUE)
source('~/Traspaso_Online/RCodes/13 Estimates.R', encoding = 'UTF-8', echo=TRUE)
install.packages("bizdays")
source('~/Traspaso_Online/RCodes/13 Estimates.R', encoding = 'UTF-8', echo=TRUE)
source('~/Traspaso_Online/RCodes/13 Estimates.R', encoding = 'UTF-8', echo=TRUE)
rm(list = ls())
librerias <- c("dplyr","ggplot2","stringr","rio","bizdays")
lapply(librerias,library, character.only = TRUE)
options(warn=0)
rm(list = ls())
librerias <- c("dplyr","ggplot2","stringr","rio","bizdays")
lapply(librerias,library, character.only = TRUE)
source('~/Traspaso_Online/RCodes/13 Estimates.R', encoding = 'UTF-8', echo=TRUE)
source('~/Traspaso_Online/RCodes/13 Estimates.R', encoding = 'UTF-8', echo=TRUE)
source('~/Traspaso_Online/RCodes/13 Estimates.R', encoding = 'UTF-8', echo=TRUE)
