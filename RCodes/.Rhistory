base$precio_internet = str_replace_all(base$precio_internet,
"299349","349")
base$precio_normal_completo = str_replace_all(base$precio_normal_completo,
"299349","349")
# Creacion ID a nivel de producto -----------------------------------------
#En este script se llama la base de datos corregida y la base de datos actualizada.
#La finalidad es generar una base de datos gran en formato panel.
#--------------------------------
#(1)Limpiamos memoria y librerias
#--------------------------------
rm(list=ls())
options(warn=0)
library(tidyverse)
library(readxl)
library(readr)
library(scales)
library(dplyr)
library(stringr)
library(ggplot2)
options(warn=2)
#--------------------------------
#(3)Base de datos
#--------------------------------
#Parte 1
load("./Base/MasterData/Base_Total_Peru.RData")
anterior=DF_TOTAL
#Parte2
fname = "./Base/MasterData/2018-09-14hasta2019-04-30.RData"
load(fname)
actual = DATA
rm(DF_TOTAL,DATA)
#Unimos
df_tot1 = rbind(anterior,actual)
rm(actual,anterior)
#--------------------------------
#(4)Limpieza
#--------------------------------
#Marca
df_tot1$marca <- str_replace(df_tot1$marca, "ga.ma", "gama")
#Descripcion
df_tot1 <- df_tot1 %>% mutate(descripcion = as.character(descripcion,width = NULL),
descripcion = gsub("\\\\","",descripcion),
descripcion = gsub("'","",descripcion),
descripcion = str_trim(descripcion, side= "both"),
descripcion = str_to_lower(descripcion))
#Marca
df_tot1$marca <- str_trim(df_tot1$marca, side= "both")
#Categoria
df_tot1 <- df_tot1 %>% mutate(categoria = str_trim(categoria, side= "both"),
cateogoria = str_to_lower(categoria)) # deletes spaces in the end and in the beginning of the string
#Subcategoria
df_tot1 <- df_tot1 %>% mutate(subcategoria = str_to_lower(subcategoria),
subcategoria = gsub("  "," ",subcategoria))%>%
subcategoria = str_trim(subcategoria,side = "both")
#Subcategoria
df_tot1 <- df_tot1 %>% mutate(subcategoria = str_to_lower(subcategoria),
subcategoria = gsub("  "," ",subcategoria)%>%
subcategoria = str_trim(subcategoria,side = "both"))
df_tot1 <- df_tot1 %>% mutate(subcategoria = str_to_lower(subcategoria),
subcategoria = gsub("  "," ",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"))
sort(unique(df_tot1$marca))
#Eliminamos un error particular
#--------------------------------
df_tot1$precio_normal = str_replace_all(df_tot1$precio_normal,
"299349","349")
df_tot1$precio_internet = str_replace_all(df_tot1$precio_internet,
"299349","349")
df_tot1$precio_normal_completo = str_replace_all(df_tot1$precio_normal_completo,
"299349","349")
#--------------------------------
#(5)Creacion de codigo unico
#--------------------------------
df_tot1 <- df_tot1 %>% mutate(id = paste(marca,descripcion,sep = "_"))%>%
left_join(df_tot1 %>% select(marca,descripcion)%>% unique()%>%
mutate(marca_descrip_id = 1:n()), by = c("marca","descripcion"))%>%
arrange(marca_descrip_id,fecha) %>% distinct()
base <- df_tot1
base <- base %>% mutate(precio_normal_completo = ifelse(is.na(precio_normal),precio_internet,precio_normal),
precio_normal_completo = as.numeric(precio_normal_completo))
# Precio member completo
#-------------------------
#Se completa el precio member con la funcion fill.
base = base %>% mutate(precio_member_completo = precio_member) %>%
group_by(marca_descrip_id) %>%
fill(precio_member_completo)
base <- base %>% mutate(marca = as.factor(marca), descripcion =as.factor(descripcion),
id = as.factor(id),subcategoria = as.factor(subcategoria),
rating = as.numeric(rating))
View(base)
View(base)
View(df_tot1)
summary(base$rating)
rm(df_tot1)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("../Base/MasterData/BasePERU_Proceso1.RData")
save(BD, file=filename)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("../Base/MasterData/BasePERU_Proceso1.RData")
save(base, file=filename)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("../Base/MasterData/BasePERU_Proceso1.RData")
save(base, file=filename)
#--------------------------------
#(7)Guardamos bases de datos
#--------------------------------
filename=paste0("./Base/MasterData/BasePERU_Proceso1.RData")
save(base, file=filename)
source('C:/Users/alexa/Dropbox/TraspasoOnline/Pass-through/Script/07 ID Creation.R', echo=TRUE)
rm(list = ls())
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(2) Base de Datos
#-----------------------------------------
load("./Base/MasterData/BasePERU_Proceso1.RData")
BASEDATOS <- BD
#(4) Eliminamos subcategorias : VER TODO...
#-----------------------------------------
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
install.packages("tm")
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(4) Eliminamos subcategorias : VER TODO...
#-----------------------------------------
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
# Correccion de categorias y subcategorias --------------------------------
#Este script se realiza la reduccion y uniformizacion de la clasificacion de los productos
#de la tienda SF, de tal manera que cuadren con la CLASIFICACION de la base de importaciones.
#(1)Limpiar memoria y cargar librerias
#----------------------------------------
rm(list = ls())
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(2) Base de Datos
#-----------------------------------------
load("./Base/MasterData/BasePERU_Proceso1.RData")
source("../CategoriasFun.R")
source("../SubcategoriasFun.R")
#(4) Eliminamos subcategorias : VER TODO...
#-----------------------------------------
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
View(base)
rack <- grep("rack", BASEDATOS$descripcion)
rack <- grep("rack", base$descripcion)
rack
base <- base %>% mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria))
View(base)
base2 <- base %>%
mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria))
View(base2)
base2 <- base %>%
mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono"),"audífono",subcategoria))
View(base2)
base2 <- base %>%
mutate(subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífono",subcategoria))
View(base2)
#Tecnologia (desaparece seccion)
#--------------------------------
tecnologia <- subset(base2, categoria =="tecnología")
View(base2)
View(tecnologia)
debugSource('C:/Users/alexa/Dropbox/TraspasoOnline/Pass-through/Script/(8)Categoria_Subcategoria.R', encoding = 'UTF-8', echo=TRUE)
View(base)
lista <- base %>% select(categoria, subcategoria) %>% unique()
View(lista)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique()
View(lista)
unique(lista$categoria)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique()
grupocat <- unique(base$categoria)
grupocat
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria %in% grupocat,subcategoria,categoria))
View(lista)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria=="tecnología",subcategoria,categoria))
View(lista)
grupocat <- unique(lista$categoria)
grupocat
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique()
View(lista)
grupocat <- unique(lista$categoria)
grupocat <- unique(base$categoria)
grupocat
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
View(lista)
grupocat <- unique(base$categoria)
base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>% View()
grupocat <- unique(base$categoria)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
unique(lista$categoria)
View(lista)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria),
categoria = ifelse(str_detect(subcategoria,"computadoras","computadores",subcategoria)))
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria),
categoria = ifelse(str_detect(subcategoria,"computadoras"),"computadores",subcategoria))
View(lista)
grupocat <- unique(base$categoria)
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
View(lista)
lista2 <- lista %>% mutate(categoria = ifelse(str_detect(categoria =="tecnología","computadoras") & categoria =="tecnología",
"computadores",subcategoria))
View(lista2)
lista2 <- lista %>% mutate(categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"computadoras"),
"computadores",categoria))
View(lista2)
lista2$subcategoria[lista2$categoria=="tecnología"]
unique(lista2$subcategoria[lista2$categoria=="tecnología"])
lista <- base %>% select(categoria, subcategoria) %>% ungroup()%>% unique() %>%
mutate(categoria = ifelse(categoria =="tecnología" & subcategoria %in% grupocat,subcategoria,categoria))
lista2 <- lista %>%
mutate(categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"computadoras"),
"computadores",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"audífono"),
"audio",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"telefonía"),
"teléfonos",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"cámaras digitales"),
"fotografía",categoria),
categoria = ifelse(categoria=="tecnología" & str_detect(subcategoria,"tv lcd|accesorios tv"),
"televisores",categoria))
View(lista2)
lista3 <- lista2 %>% select(-subcategoria)%>%group_by(ID,categoria)%>% summarize(repeticiones = n())
View(lista3)
lista3 <- lista2%>%group_by(ID,categoria,subcategoria)%>% summarize(repeticiones = n())
View(lista3)
lista3 <- lista2%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())
View(lista3)
diccionario <- lista3%>% group_by(categoria,subcategoria)%>% summarise(rep = n())
View(diccionario)
diccionario <- lista3%>% select(-categoria)%>% summarise(rep = n())
View(diccionario)
lista3%>% select(-categoria)
lista3 <- lista2%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
diccionario <- lista3%>% select(-categoria)%>% summarise(rep = n())
View(diccionario)
lista3%>% select(-categoria)
diccionario <- lista3%>% select(-categoria)%>%group_by(subcategoria)%>% summarise(rep = n())
View(diccionario)
# Correccion de categorias y subcategorias --------------------------------
#Este script se realiza la reduccion y uniformizacion de la clasificacion de los productos
#de la tienda SF, de tal manera que cuadren con la CLASIFICACION de la base de importaciones.
#(1)Limpiar memoria y cargar librerias
#----------------------------------------
rm(list = ls())
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
#
# source("../CategoriasFun.R")
# source("../SubcategoriasFun.R")
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
# Grupo de categorias
grupocat <- unique(base$categoria)
grupocat
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
View(base)
# Grupo de categorias
grupocat <- unique(base$categoria)
grupocat
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
View(base)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
View(base)
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
correcciones <- lista3%>% select(-categoria)%>%group_by(subcategoria)%>% summarise(rep = n()) %>%
filter(rep>1)
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
View(lista3)
base <- base %>% left_join(lista3 %>% select(-repeticiones), by = "subcategoria")
View(base)
base <- base %>% left_join(lista3 %>% select(-repeticiones), by = "subcategoria") %>%
mutate(categoria.x = categoria.y, categoria = categoria.x)%>% select(-categoria.y)
View(base)
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
#
# source("../CategoriasFun.R")
# source("../SubcategoriasFun.R")
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
# Correcciones por categoria ---> Se crea una lista de categoria y subcategoria correcta
# con la finalidad de unir por subcategoria y corregir la categoria
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
base <- base %>% left_join(lista3 %>% select(-repeticiones), by = "subcategoria") %>%
mutate(categoria = categoria.y)%>% select(-c(categoria.y,categoria.x))
View(base)
View(lista3)
View(lista3)
View(base)
lista4 <- base%>%group_by(ID,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
View(lista4)
lista4 <- base%>%group_by(ID,subcategoria)%>% mutate(repeticiones = n())%>%ungroup()
base_c <- base%>%group_by(ID,subcategoria)%>% mutate(repeticiones = n())%>%ungroup()
View(base_c)
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%View()
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeteciones ==max(repeteciones)%>%View())
base <- base %>% left_join(base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones)%>%View()))
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones)
base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones))%>%View()
base_c <- base %>% left_join(base%>%group_by(ID,subcategoria)%>% summarise(repeticiones = n())%>%ungroup()%>%
group_by(ID)%>%filter(repeticiones ==max(repeticiones))%>%select(-repeticiones),
by = "ID")
rm(list = ls())
#(2) Base de Datos
#-----------------------------------------
load("./Base/MasterData/BasePERU_Proceso1.RData")
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = gsub("-"," ",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
librerias <- c("tidyverse","dplyr","ggplot2","stringr", "tm", "data.table")
lapply(librerias, library, character.only =TRUE)
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = gsub("-"," ",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria))
# Grupo de categorias
grupocat <- unique(base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(
str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
View(lista3)
View(base)
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"refrigeracion"),"refrigeración",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"cocina"),"cocinas",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"linea blanca"),"línea blanca",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"ventiladores y aire acondicionado|ventiladores"),"ventilación y aire acondicionado",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"smartphones"),"celulares y smartphones",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"televisores|tv|tv televisores"),"tv",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"teléfonos|telefonía"),"accesorios smartphone",subcategoria))
View(base)
#(2) Base de Datos
load("./Base/MasterData/BasePERU_Proceso1.RData")
#(4) Eliminamos subcategorias : VER TODO...
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = gsub("-"," ",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria))
base <- base %>% mutate(subcategoria = as.character(subcategoria),
subcategoria = gsub("ver todo","",subcategoria),
subcategoria = str_trim(subcategoria,side = "both"),
subcategoria = stripWhitespace(subcategoria),
subcategoria = ifelse(str_detect(descripcion,"rack"),"accesorios tv",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"tv led|combo led"),"tv led",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"lcd"),"tv lcd",subcategoria),
subcategoria = ifelse(str_detect(descripcion,"audífono|audífonos|audifono"),"audífonos",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"refrigeracion"),"refrigeración",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"cocina"),"cocinas",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"linea blanca"),"línea blanca",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"ventiladores y aire acondicionado|ventiladores"),"ventilación y aire acondicionado",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"smartphones"),"celulares y smartphones",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"televisores|tv televisores"),"tv",subcategoria),
subcategoria = ifelse(str_detect(subcategoria,"teléfonos|telefonía"),"accesorios smartphone",subcategoria))
# Grupo de categorias --> Tecnologia
grupocat <- unique(base$categoria)
base$categoria = ifelse(base$categoria =="tecnología" & base$subcategoria %in% grupocat,base$subcategoria,base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"computadoras"),
"computadores",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"audífono"),
"audio",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"telefonía"),
"teléfonos",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"cámaras digitales"),
"fotografía",base$categoria)
base$categoria = ifelse(base$categoria=="tecnología" & str_detect(base$subcategoria,"tv lcd|accesorios tv"),
"televisores",base$categoria)
View(base)
lista3 <- base%>%select(-ID)%>%group_by(categoria,subcategoria)%>% summarize(repeticiones = n())%>%ungroup()
lista3 <- lista3 %>% group_by(subcategoria) %>% filter(repeticiones == max(repeticiones)) %>%
ungroup()%>%
mutate(categoria = ifelse(
str_detect("(home theater)|(home theaters)|soundbars y home theaters|home theater y soundbar",subcategoria),"audio",categoria))%>%
arrange(categoria)
View(lista3)
View(lista3)
source('~/Traspaso_Online/RCodes/08 Category Subcategory correction.R', encoding = 'UTF-8', echo=TRUE)
